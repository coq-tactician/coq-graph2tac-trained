opam-version: "2.0"
synopsis: "Graph neural network that predicts tactics for Tactician"
description: ""
maintainer: ["Lasse Blaauwbroek <lasse@blaauwbroek.eu>"]
authors: [
  "Lasse Blaauwbroek"
  "Mirek Olsak"
  "Vasily Pestun"
  "Jelle Piepenbrock"
  "Jason Rute"
  "Fidel I. Schaposnik Massolo"
]
homepage: "https://coq-tactician.github.io"
bug-reports:
  "https://github.com/pestun/graph2tac/issues"
build: [
  [ "tar" "xzf" "model.tar.gz" "--one-top-level" "--strip-components" "1" ]
]
# merges + vocab
install: [
  [ "mkdir" "--parents" "%{share}%/%{name}%/" ]
  [ "cp" "-r" "model/" "%{share}%/%{name}%/" ]
  [ "mkdir" "%{share}%/%{name}%/tokenizer/" ]
  [ "cp" "vocab.json" "%{share}%/%{name}%/tokenizer/vocab.json" ]
  [ "cp" "merges.txt" "%{share}%/%{name}%/tokenizer/merges.txt" ]
  [ "cp" "Graph2TacConfig.v" "%{lib}%/coq/user-contrib/Tactician/Graph2TacConfig.v" ]

  # We have to make sure that our injection flags get loaded after the injection flags of coq-tactician-reinforce.
  # We do this by using a name that is guaranteed to sort after coq-tactician-reinforce.
  [ "mkdir" "--parents" "%{share}%/coq-tactician/plugins/coq-tactician-reinforce-%{name}%/" ]
  [ "cp" "injection-flags" "%{share}%/coq-tactician/plugins/coq-tactician-reinforce-%{name}%/" ]
]
dev-repo: "git+https://github.com/pestun/graph2tac.git"
pin-depends: [
  [
    "coq-tactician.8.11.dev"
    "git+https://github.com/coq-tactician/coq-tactician.git#d46eea21558d382888fc5a25e238af3be31c9a00"
  ]
  [
    "coq-tactician-reinforce.8.11.dev"
    "git+ssh://git@github.com/coq-tactician/coq-tactician-reinforce.git#a8a620ab0910e6f898a6649978cac379f944526e"
  ]
]
depends: [
  "coq-tactician-reinforce"
  "coq-tactician"
]
# md5sum [file]

#extra-source "model.tar.gz" {
#  src: "http://64.71.146.254:8000/SFyud_C5TmEq7AwnK9jaLsfTFMzgBl54cQ0pl2FJB-x9o2Hk24F4jO_W75RqGdOJ/weights/transformer_first_benchmark/checkpoint-760000.tar.gz"
#  checksum: "82ae86304d20eeab5edea0e80066fdba"  
#}
#extra-source "merges.txt" {
#  src: "http://64.71.146.254:8000/SFyud_C5TmEq7AwnK9jaLsfTFMzgBl54cQ0pl2FJB-x9o2Hk24F4jO_W75RqGdOJ/weights/transformer_first_benchmark/merges.txt"
#  checksum: "a67d75e02d3697ebf1813805e4e7af97"
#}

#extra-source "vocab.json" {
#  src: "http://64.71.146.254:8000/SFyud_C5TmEq7AwnK9jaLsfTFMzgBl54cQ0pl2FJB-x9o2Hk24F4jO_W75RqGdOJ/weights/transformer_first_benchmark/vocab.json"
#  checksum: "dd767ef9a25e4bbce7d68c0912d3149b"
#}

extra-source "model.tar.gz" {
  src: "http://64.71.146.254:8000/SFyud_C5TmEq7AwnK9jaLsfTFMzgBl54cQ0pl2FJB-x9o2Hk24F4jO_W75RqGdOJ/weights/transformer_share_1512/checkpoint-507000.tar.gz"
  checksum: "89ceee1900bc74b6a6ad3c039ad3710a"  
}
extra-source "merges.txt" {
  src: "http://64.71.146.254:8000/SFyud_C5TmEq7AwnK9jaLsfTFMzgBl54cQ0pl2FJB-x9o2Hk24F4jO_W75RqGdOJ/weights/transformer_share_1512/merges.txt"
  checksum: "fd2893d44d789730e9c15162a85dee28"
}

extra-source "vocab.json" {
  src: "http://64.71.146.254:8000/SFyud_C5TmEq7AwnK9jaLsfTFMzgBl54cQ0pl2FJB-x9o2Hk24F4jO_W75RqGdOJ/weights/transformer_share_1512/vocab.json"
  checksum: "950ce4aac69f0578f07323e02b1cc98e"
}
substs: [
  "Graph2TacConfig.v"
]
